@page "/signup"
@inject HttpClient Http
@inject NavigationManager Nav
@rendermode InteractiveServer
@using Models

<h3>Signup</h3>

<div>
    <input @bind="signup.Username" placeholder="Username" />
    <input @bind="signup.Email" placeholder="Email" type="email" />
    <input @bind="signup.Password" placeholder="Password" type="password" />
    <button type="button" @onclick="HandleSignup">Signup</button> <!-- ✅ Added type="button" -->
</div>

<p style="color:red">@errorMessage</p>

@code {
    private UserSignup signup = new();
    private string errorMessage = "";

    private async Task HandleSignup()
    {
        Console.WriteLine("Signup clicked!"); // ✅ Debug log
        try
        {
            var response = await Http.PostAsJsonAsync("https://localhost:7082/api/auth/signup", signup);

            if (response.IsSuccessStatusCode)
            {
                Nav.NavigateTo("/login");
            }
            else
            {
                errorMessage = await response.Content.ReadAsStringAsync();
                Console.WriteLine(response.Content.ReadAsStringAsync());
            }
        } catch(Exception ex)
        {
            Console.WriteLine($"Exception Message: {ex.Message}");
        }

    }
}
